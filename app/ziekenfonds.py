from PyPDF2 import PdfFileWriter, PdfFileReader
import io, os
from reportlab.pdfgen import canvas
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont


basedir = os.path.abspath(os.path.dirname(__file__))
packet = io.BytesIO()
can = canvas.Canvas(packet)

pdfmetrics.registerFont(TTFont('Arial', 'arial.ttf'))
can.setFont('Arial', 10)

# formulier invullen
# Als ziekenfonds is CM
existing_pdf = PdfFileReader(open(basedir + "/templates/formulieren/form_CM.pdf", "rb"))

can.drawString(90, 681, "Vanhastel")
can.drawString(350, 681, "Koen")
can.drawString(90, 663, "Sneppe")
can.drawString(320, 663, "44")
can.drawString(408, 663, "BUS")
can.drawString(97, 645, "8540")
can.drawString(195, 645, "Deerlijk")
can.drawString(380, 645, "België")
can.drawString(85, 627, "0479/915460")
can.drawString(250, 627, "koen.vanhastel@gmail.com")
can.drawString(160, 562, "Badmintonclub Tielt")
can.drawString(100, 544, "Sneppe 44, 8540 Deerlijk")
can.drawString(185, 526, "koen.vanhastel@gmail.com")
can.drawString(240, 508, "01/09/2018 - 31/08/2019")
can.drawString(130, 491, "€ 90")
can.drawString(130, 473, "01/09/2018")
can.drawString(56, 430, "X")
can.drawString(250, 395, "Badminton")
can.drawString(205, 378, "Badminton Vlaanderen")
can.drawString(90, 319, "1")
can.drawString(104, 319, "0")
can.drawString(128, 319, "1")
can.drawString(141, 319, "1")
can.drawString(165, 319, "2")
can.drawString(179, 319, "0")
can.drawString(192, 319, "1")
can.drawString(206, 319, "8")
can.save()

'''
# Als ziekenfonds is LM
existing_pdf = PdfFileReader(open(basedir + "/templates/formulieren/form_LM.pdf", "rb"))
can.drawString(90, 681, "Vanhastel")
can.drawString(350, 681, "Koen")
can.drawString(90, 663, "Sneppe")
can.drawString(320, 663, "44")
can.drawString(408, 663, "BUS")
can.drawString(97, 645, "8540")
can.drawString(195, 645, "Deerlijk")
can.drawString(380, 645, "België")
can.drawString(85, 627, "0479/915460")
can.drawString(250, 627, "koen.vanhastel@gmail.com")
can.drawString(160, 562, "Badmintonclub Tielt")
can.drawString(100, 544, "Sneppe 44, 8540 Deerlijk")
can.drawString(185, 526, "koen.vanhastel@gmail.com")
can.drawString(240, 508, "01/09/2018 - 31/08/2019")
can.drawString(130, 491, "€ 90")
can.drawString(130, 473, "01/09/2018")
can.drawString(56, 430, "X")
can.drawString(250, 395, "Badminton")
can.drawString(205, 378, "Badminton Vlaanderen")
can.drawString(90, 319, "1")
can.drawString(104, 319, "0")
can.drawString(128, 319, "1")
can.drawString(141, 319, "1")
can.drawString(165, 319, "2")
can.drawString(179, 319, "0")
can.drawString(192, 319, "1")
can.drawString(206, 319, "8")
can.save()
# Als ziekenfonds is VNZ
existing_pdf = PdfFileReader(open(basedir + "/templates/formulieren/form_VNZ.pdf", "rb"))
can.drawString(90, 681, "Vanhastel")
can.drawString(350, 681, "Koen")
can.drawString(90, 663, "Sneppe")
can.drawString(320, 663, "44")
can.drawString(408, 663, "BUS")
can.drawString(97, 645, "8540")
can.drawString(195, 645, "Deerlijk")
can.drawString(380, 645, "België")
can.drawString(85, 627, "0479/915460")
can.drawString(250, 627, "koen.vanhastel@gmail.com")
can.drawString(160, 562, "Badmintonclub Tielt")
can.drawString(100, 544, "Sneppe 44, 8540 Deerlijk")
can.drawString(185, 526, "koen.vanhastel@gmail.com")
can.drawString(240, 508, "01/09/2018 - 31/08/2019")
can.drawString(130, 491, "€ 90")
can.drawString(130, 473, "01/09/2018")
can.drawString(56, 430, "X")
can.drawString(250, 395, "Badminton")
can.drawString(205, 378, "Badminton Vlaanderen")
can.drawString(90, 319, "1")
can.drawString(104, 319, "0")
can.drawString(128, 319, "1")
can.drawString(141, 319, "1")
can.drawString(165, 319, "2")
can.drawString(179, 319, "0")
can.drawString(192, 319, "1")
can.drawString(206, 319, "8")
can.save()
# Als ziekenfonds is BM
existing_pdf = PdfFileReader(open(basedir + "/templates/formulieren/form_BM.pdf", "rb"))
can.drawString(90, 681, "Vanhastel")
can.drawString(350, 681, "Koen")
can.drawString(90, 663, "Sneppe")
can.drawString(320, 663, "44")
can.drawString(408, 663, "BUS")
can.drawString(97, 645, "8540")
can.drawString(195, 645, "Deerlijk")
can.drawString(380, 645, "België")
can.drawString(85, 627, "0479/915460")
can.drawString(250, 627, "koen.vanhastel@gmail.com")
can.drawString(160, 562, "Badmintonclub Tielt")
can.drawString(100, 544, "Sneppe 44, 8540 Deerlijk")
can.drawString(185, 526, "koen.vanhastel@gmail.com")
can.drawString(240, 508, "01/09/2018 - 31/08/2019")
can.drawString(130, 491, "€ 90")
can.drawString(130, 473, "01/09/2018")
can.drawString(56, 430, "X")
can.drawString(250, 395, "Badminton")
can.drawString(205, 378, "Badminton Vlaanderen")
can.drawString(90, 319, "1")
can.drawString(104, 319, "0")
can.drawString(128, 319, "1")
can.drawString(141, 319, "1")
can.drawString(165, 319, "2")
can.drawString(179, 319, "0")
can.drawString(192, 319, "1")
can.drawString(206, 319, "8")
can.save()
# Als ziekenfonds is OZ
existing_pdf = PdfFileReader(open(basedir + "/templates/formulieren/form_OZ.pdf", "rb"))
can.drawString(90, 681, "Vanhastel")
can.drawString(350, 681, "Koen")
can.drawString(90, 663, "Sneppe")
can.drawString(320, 663, "44")
can.drawString(408, 663, "BUS")
can.drawString(97, 645, "8540")
can.drawString(195, 645, "Deerlijk")
can.drawString(380, 645, "België")
can.drawString(85, 627, "0479/915460")
can.drawString(250, 627, "koen.vanhastel@gmail.com")
can.drawString(160, 562, "Badmintonclub Tielt")
can.drawString(100, 544, "Sneppe 44, 8540 Deerlijk")
can.drawString(185, 526, "koen.vanhastel@gmail.com")
can.drawString(240, 508, "01/09/2018 - 31/08/2019")
can.drawString(130, 491, "€ 90")
can.drawString(130, 473, "01/09/2018")
can.drawString(56, 430, "X")
can.drawString(250, 395, "Badminton")
can.drawString(205, 378, "Badminton Vlaanderen")
can.drawString(90, 319, "1")
can.drawString(104, 319, "0")
can.drawString(128, 319, "1")
can.drawString(141, 319, "1")
can.drawString(165, 319, "2")
can.drawString(179, 319, "0")
can.drawString(192, 319, "1")
can.drawString(206, 319, "8")
can.save()
# Als ziekenfonds is PAR
existing_pdf = PdfFileReader(open(basedir + "/templates/formulieren/form_PAR.pdf", "rb"))
can.drawString(90, 681, "Vanhastel")
can.drawString(350, 681, "Koen")
can.drawString(90, 663, "Sneppe")
can.drawString(320, 663, "44")
can.drawString(408, 663, "BUS")
can.drawString(97, 645, "8540")
can.drawString(195, 645, "Deerlijk")
can.drawString(380, 645, "België")
can.drawString(85, 627, "0479/915460")
can.drawString(250, 627, "koen.vanhastel@gmail.com")
can.drawString(160, 562, "Badmintonclub Tielt")
can.drawString(100, 544, "Sneppe 44, 8540 Deerlijk")
can.drawString(185, 526, "koen.vanhastel@gmail.com")
can.drawString(240, 508, "01/09/2018 - 31/08/2019")
can.drawString(130, 491, "€ 90")
can.drawString(130, 473, "01/09/2018")
can.drawString(56, 430, "X")
can.drawString(250, 395, "Badminton")
can.drawString(205, 378, "Badminton Vlaanderen")
can.drawString(90, 319, "1")
can.drawString(104, 319, "0")
can.drawString(128, 319, "1")
can.drawString(141, 319, "1")
can.drawString(165, 319, "2")
can.drawString(179, 319, "0")
can.drawString(192, 319, "1")
can.drawString(206, 319, "8")
can.save()
'''

#move to the beginning of the StringIO buffer
packet.seek(0)
new_pdf = PdfFileReader(packet)
# read your existing PDF

output = PdfFileWriter()
# add the "watermark" (which is the new pdf) on the existing page
page = existing_pdf.getPage(0)
page.mergePage(new_pdf.getPage(0))
output.addPage(page)
# finally, write "output" to a real file

# Als ziekenfonds is CM
outputStream = open(basedir + "/templates/formulieren/form_CM_filled.pdf", "wb")
# Als ziekenfonds is LM
# outputStream = open(basedir + "/templates/formulieren/form_LM_filled.pdf", "wb")
# Als ziekenfonds is VNZ
# outputStream = open(basedir + "/templates/formulieren/form_VNZ_filled.pdf", "wb")
# Als ziekenfonds is BM
# outputStream = open(basedir + "/templates/formulieren/form_BM_filled.pdf", "wb")
# Als ziekenfonds is OZ
# outputStream = open(basedir + "/templates/formulieren/form_OZ_filled.pdf", "wb")
# Als ziekenfonds is PAR
# outputStream = open(basedir + "/templates/formulieren/form_PAR_filled.pdf", "wb")

output.write(outputStream)
outputStream.close()
